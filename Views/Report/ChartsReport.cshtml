@using System.Security.Claims
@model StackFlow.ViewModels.UserReportsCombinedViewModel
@inject Microsoft.AspNetCore.Mvc.Rendering.IJsonHelper Json

@{
    ViewData["Title"] = "User Charts";

    // Prepare data for charts
    var roleDistribution = Model.ActiveUsers
        .GroupBy(u => u.User.Role?.Name ?? "No Role")
        .Select(g => new { Role = g.Key, Count = g.Count() })
        .OrderByDescending(r => r.Count)
        .ToList();

    var ticketStatusDistribution = new
    {
        ToDo = Model.ActiveUsers.Sum(u => u.ToDoTicketsAssigned),
        InProgress = Model.ActiveUsers.Sum(u => u.InProgressTicketsAssigned),
        InReview = Model.ActiveUsers.Sum(u => u.InReviewTicketsAssigned),
        Completed = Model.ActiveUsers.Sum(u => u.CompletedTicketsAssigned)
    };

    var topUsersByTickets = Model.ActiveUsers
        .OrderByDescending(u => u.TotalTicketsAssigned)
        .Take(5)
        .ToList();
}
<div class="card shadow-lg border-0 rounded-4 p-4 mt-4 mb-4">
    <div class="d-flex justify-content-between align-items-start mb-3">
        <h2 class="card-title mb-0 fw-bold text-primary display-6">
            <i class="bi bi-graph-up-arrow me-2"></i> User Charts
        </h2>
        <a asp-action="UserReports" asp-controller="Report" class="btn btn-outline-secondary rounded-pill shadow-sm animate-btn">
            <i class="bi bi-arrow-left-circle me-1"></i> Back to User Reports
        </a>
    </div>
    <hr class="mb-4" />

    @* Visualization Section - All charts displayed *@
    <div class="row mb-4">
        @* Role Distribution Pie Chart *@
        <div class="col-lg-6 mb-4 chart-container" id="chart-container-0">
            <div class="card h-100 shadow-sm rounded-4">
                <div class="card-header bg-primary text-white rounded-top-4">
                    <h5 class="card-title mb-0"><i class="bi bi-pie-chart-fill me-2"></i>Role Distribution</h5>
                </div>
                <div class="card-body">
                    <canvas id="roleDistributionChart" height="300"></canvas>
                </div>
            </div>
        </div>
        @* Ticket Status Distribution Bar Chart *@
        <div class="col-lg-6 mb-4 chart-container" id="chart-container-1">
            <div class="card h-100 shadow-sm rounded-4">
                <div class="card-header bg-info text-white rounded-top-4">
                    <h5 class="card-title mb-0"><i class="bi bi-bar-chart-fill me-2"></i>Ticket Status Distribution</h5>
                </div>
                <div class="card-body">
                    <canvas id="ticketStatusChart" height="300"></canvas>
                </div>
            </div>
        </div>
